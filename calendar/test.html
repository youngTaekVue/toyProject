<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset='utf-8' />
    <title>FullCalendar & Express ì—°ë™ ì˜ˆì œ</title>

    <style>
        body { margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif; }
        #calendar {
            max-width: 1100px;
            margin: 40px auto;
            padding: 10px;
        }
    </style>
</head>
<body>
<div id='calendar'></div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.13/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay'
            },

            selectable: true, // ğŸ‘ˆ ì¼ì • ì¶”ê°€ë¥¼ ìœ„í•´ í•„ìˆ˜

            // ğŸŒŸ ì¡°íšŒ API (ê¸°ì¡´ ì½”ë“œ)
            events: 'http://localhost:3000/calendar/api/events',

            // ğŸŒŸ ì¼ì • ìƒì„± ë¡œì§ (ì¶”ê°€)
            select: function(info) {
                var title = prompt('ìƒˆ ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”:');

                if (title) {
                    // ì„œë²„ì˜ POST APIë¡œ ì¼ì • ìƒì„± ìš”ì²­
                    createEventOnServer(title, info.startStr, info.endStr, info.allDay, calendar);
                }
                // ì„ íƒ ì˜ì—­ í•´ì œ
                calendar.unselect();
            },

            // ... ê¸°íƒ€ ì˜µì…˜ ...
        });

        calendar.render();
    });

    // ì„œë²„ì— ì¼ì • ìƒì„± ìš”ì²­ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜
    function createEventOnServer(title, startStr, endStr, allDay, calendar) {
        const eventData = {
            title: title,
            start: startStr,
            end: endStr,
            allDay: allDay
        };

        fetch('http://localhost:3000/calendar/api/insert', { // ğŸ‘ˆ POST ìš”ì²­
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(eventData),
        })
            .then(response => {
                if (!response.ok) {
                    // ì„œë²„ ì‘ë‹µì´ 200ì´ ì•„ë‹ ê²½ìš° ì˜¤ë¥˜ ì²˜ë¦¬
                    return response.json().then(err => { throw new Error(err.error || 'ì¼ì • ì¶”ê°€ ì‹¤íŒ¨'); });
                }
                return response.json();
            })
            .then(data => {
                if (data.id) {
                    alert('ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    // FullCalendarì— ì´ë²¤íŠ¸ ì¶”ê°€ ë° í™”ë©´ ìƒˆë¡œê³ ì¹¨
                    calendar.addEvent({
                        id: data.id,
                        title: data.title,
                        start: data.start,
                        end: data.end,
                        allDay: data.allDay,
                        url: data.url // Google Calendar ë§í¬ í¬í•¨
                    });
                } else {
                    // ì´ ì½”ë“œëŠ” ë³´í†µ ì‹¤í–‰ë˜ì§€ ì•Šì§€ë§Œ, ë§Œì•½ì„ ìœ„í•´ ì²˜ë¦¬
                    alert('ì¼ì • ì¶”ê°€ ì‹¤íŒ¨: ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
                }
            })
            .catch(error => {
                console.error('í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ë˜ëŠ” ì„œë²„ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
                alert(`ì¼ì • ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            });
    }
</script>
</body>
</html>